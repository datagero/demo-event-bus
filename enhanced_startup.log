[0;35m================================================================================================[0m
[0;35mğŸš€ Starting Demo Event Bus - Complete Go Migration[0m
[0;35m================================================================================================[0m
[0;36mğŸ“Š Configuration:[0m
   ğŸ° RabbitMQ: localhost:5672 (Management: 15672) - External
   ğŸ—ï¸  Go API Server: localhost:9000
   âš¡ Go Workers: localhost:8001
[0;35m================================================================================================[0m
[1;33mâ„¹ï¸  Note: RabbitMQ must be started manually before running this script[0m
[1;33m   Run: docker-compose up -d[0m
[0;35m================================================================================================[0m

[0;35mğŸ“‹ Step 1: Building and Starting Go API Server[0m
[0;34mğŸ” Checking RabbitMQ availability...[0m
[0;32mâœ… RabbitMQ AMQP port 5672 is accessible[0m
[0;34mğŸ”¨ Building Go API Server...[0m
[0;32mâœ… Go API Server built successfully[0m
[0;34mğŸš€ Starting Go API Server on port 9000...[0m
[0;32mâœ… Go API Server started (PID: 77825), logging to api-server.log[0m
[0;34mğŸ”„ Waiting for Go API Server on port 9000...[0m
[1;33m   Attempt 1/30...[0m
[0;32mâœ… Go API Server is ready on port 9000[0m
[0;34mğŸ§ª Testing Go API Server Health: http://localhost:9000/health[0m
[0;32mâœ… Go API Server Health endpoint is responding[0m

[0;35mğŸ“‹ Step 2: Building and Starting Go Workers[0m
[0;34mğŸ”¨ Building Go Workers...[0m
[0;32mâœ… Go Workers built successfully[0m
[0;34mğŸš€ Starting Go Workers on port 8001...[0m
[0;32mâœ… Go Workers started (PID: 77868), logging to workers.log[0m
[0;34mğŸ”„ Waiting for Go Workers on port 8001...[0m
[1;33m   Attempt 1/30...[0m
[0;32mâœ… Go Workers is ready on port 8001[0m
[0;34mğŸ§ª Testing Go Workers Health: http://localhost:8001/health[0m
[0;32mâœ… Go Workers Health endpoint is responding[0m

[0;35mğŸ“‹ Step 3: Testing Complete System Integration[0m
[0;34mğŸ§ª Testing Go API Server endpoints...[0m
[0;32mâœ… RabbitMQ-direct metrics working[0m
[0;32mâœ… Chaos engineering endpoints working[0m
[0;34mğŸ§ª Testing native message publishing...[0m
[0;31mâŒ Message publishing test failed[0m

[0;35mğŸ“‹ Step 4: System Information[0m

[0;36mğŸŒ Service URLs:[0m
   ğŸ  Frontend:              http://localhost:9000/
   ğŸ”§ Go API Server:         http://localhost:9000/api/
   âš¡ Go Workers:            http://localhost:8001/
   ğŸ° RabbitMQ Management:   http://localhost:15672/ (guest/guest)

[0;36mğŸ”— Key Endpoints:[0m
   ğŸ“Š RabbitMQ Metrics:      http://localhost:9000/api/rabbitmq/metrics
   ğŸ‘¥ Player Creation:       POST http://localhost:9000/api/players/quickstart
   ğŸ“¨ Message Publishing:    POST http://localhost:9000/api/publish
   âš¡ Chaos Engineering:     POST http://localhost:9000/api/chaos/arm
   ğŸ® Scenarios:             POST http://localhost:9000/api/scenario/run
   ğŸ’€ DLQ Management:        POST http://localhost:9000/api/dlq/setup

[0;36mğŸ“ˆ Educational Features:[0m
   ğŸ¯ RabbitMQ-Direct Architecture - Zero abstraction layers
   ğŸ” Management API Integration - Live broker introspection
   âš¡ Native Chaos Engineering - Direct RabbitMQ operations
   ğŸ’€ Comprehensive DLQ System - Native dead letter handling
   ğŸŒ WebSocket Broadcasting - Real-time UI updates
   ğŸš€ Pure Go Implementation - No Python dependencies

[0;36mğŸ® Quick Start Commands:[0m
   # Create Alice and Bob workers
   curl -X POST http://localhost:9000/api/players/quickstart -H 'Content-Type: application/json' -d '{"preset":"alice_bob"}'

   # Publish a quest
   curl -X POST http://localhost:9000/api/publish -H 'Content-Type: application/json' -d '{"routing_key":"game.quest.gather","payload":{"case_id":"quest-1","quest_type":"gather","points":5}}'

   # Run late-bind escort scenario
   curl -X POST http://localhost:9000/api/scenario/run -H 'Content-Type: application/json' -d '{"scenario":"late-bind-escort"}'

   # Trigger chaos (purge queue)
   curl -X POST http://localhost:9000/api/chaos/arm -H 'Content-Type: application/json' -d '{"action":"rmq_purge_queue","target_queue":"game.skill.gather.q"}'

[0;35m================================================================================================[0m
[0;32mğŸ‰ Demo Event Bus - Complete Go Migration is running![0m
[0;35m================================================================================================[0m
[0;36mğŸ“Š Architecture: RabbitMQ (External) + Go API Server + Go Workers[0m
[0;36mğŸ¯ Educational Focus: Direct RabbitMQ integration with minimal abstraction[0m
[0;36mğŸŒ Frontend: http://localhost:9000/[0m
[1;33mâ„¹ï¸  RabbitMQ managed separately via: docker-compose up -d[0m
[0;35m================================================================================================[0m
[1;33mPress Ctrl+C to stop all services[0m

[0;34mğŸ”„ Monitoring services... (Check status with: ./check_status.sh)[0m
[0;34mğŸ”„ To restart individual services during development:[0m
[0;34m   ./restart_api.sh     - Restart API server[0m
[0;34m   ./restart_workers.sh - Restart workers[0m
[0;35m================================================================================================[0m
[0;36mğŸ“‹ Live Logs (API Server + Workers):[0m
[0;37mTip: Use Ctrl+C to stop all services[0m
[0;35m================================================================================================[0m
[0;37m13:35:53[0m [0;34m[API_SERVER][0m 2025/08/15 13:35:53 [2025-08-15T13:35:53+02:00] localhost:9000 says: Publishing message with correlation_id=200d65cc-a3ea-4fec-b2d0-5eb5ace513f2 to routing_key=game.quest.gather
[0;37m13:35:53[0m [0;34m[API_SERVER][0m 2025/08/15 13:35:53 [2025-08-15T13:35:53+02:00] localhost:9000 says: Message payload: {"case_id":"startup-test","correlation_id":"200d65cc-a3ea-4fec-b2d0-5eb5ace513f2","points":5,"published_at":1755257753,"published_by":"api_endpoint","quest_type":"gather"}
[0;37m13:35:53[0m [0;34m[API_SERVER][0m 2025/08/15 13:35:53 [2025-08-15T13:35:53+02:00] localhost:9000 says: SUCCESS published message correlation_id=200d65cc-a3ea-4fec-b2d0-5eb5ace513f2
[0;37m13:35:53[0m [0;34m[API_SERVER][0m [GIN] 2025/08/15 - 13:35:53 | 200 |     905.375Âµs |             ::1 | POST     "/api/publish"
[0;37m13:35:53[0m [0;35m[SYSTEM][0m 2025/08/15 13:35:51 ğŸš€ [Go Server] Starting on port 8001
[0;37m13:35:56[0m [0;32m[WORKERS][0m 2025/08/15 13:35:56 ğŸƒ [Go Worker] alice-worker-0 started on queue game.skill.gather.q
[0;37m13:35:56[0m [0;34m[API_SERVER][0m 2025/08/15 13:35:56 ğŸ“¬ [Go Worker Debug] alice received raw message: {"id":"q-1755257753-583454000","payload":{"case_id":"startup-test","correlation_id":"200d65cc-a3ea-4fec-b2d0-5eb5ace513f2","points":5,"published_at":1755257753,"published_by":"api_endpoint","quest_type":"gather"},"points":5,"timestamp":1755257753,"type":"game.quest.gather"}
[0;37m13:35:56[0m [0;32m[WORKERS][0m 2025/08/15 13:35:56 âœ… [Go Worker Debug] alice parsed message: {CaseID:startup-test EventStage: Status: Source: QuestType:gather Difficulty:0 WorkSec:0 Points:5 Weight:0 Player: Payload:map[]}
[0;37m13:35:56[0m [0;32m[WORKERS][0m 2025/08/15 13:35:56 âœ… [Go Worker Debug] alice parsed message: {CaseID:startup-test EventStage:QUEST_COMPLETED Status:SUCCESS Source:go-worker:alice QuestType:gather Difficulty:0 WorkSec:0 Points:5 Weight:0 Player:alice Payload:map[]}
[0;37m13:35:56[0m [0;34m[API_SERVER][0m [GIN] 2025/08/15 - 13:35:56 | 200 |        48.5Âµs |             ::1 | POST     "/api/go-workers/webhook/events"
[0;37m13:35:56[0m [0;34m[API_SERVER][0m [GIN] 2025/08/15 - 13:35:56 | 200 |      57.834Âµs |             ::1 | POST     "/api/go-workers/webhook/events"
[0;37m13:35:56[0m [0;32m[WORKERS][0m 2025/08/15 13:35:56 ğŸš€ [Go Worker] alice started with 1 workers, skills: [gather slay]
[0;37m13:35:56[0m [0;32m[WORKERS][0m 2025/08/15 13:35:56 âœ… [Server] Started worker: alice
[0;37m13:35:56[0m [0;32m[WORKERS][0m 2025/08/15 13:35:56 ğŸƒ [Go Worker] alice-worker-0 started on queue game.skill.slay.q
[0;37m13:35:56[0m [0;34m[API_SERVER][0m [GIN] 2025/08/15 - 13:35:56 | 200 |      17.541Âµs |             ::1 | POST     "/api/go-workers/webhook/events"
[0;37m13:35:56[0m [0;32m[WORKERS][0m 2025/08/15 13:35:56 ğŸƒ [Go Worker] bob-worker-0 started on queue game.skill.slay.q
[0;37m13:35:56[0m [0;32m[WORKERS][0m 2025/08/15 13:35:56 ğŸš€ [Go Worker] bob started with 1 workers, skills: [slay escort]
[0;37m13:35:56[0m [0;32m[WORKERS][0m 2025/08/15 13:35:56 âœ… [Server] Started worker: bob
[0;37m13:35:56[0m [0;32m[WORKERS][0m 2025/08/15 13:35:56 ğŸƒ [Go Worker] bob-worker-0 started on queue game.skill.escort.q
[0;37m13:35:56[0m [0;34m[API_SERVER][0m [GIN] 2025/08/15 - 13:35:56 | 200 |   21.040667ms |             ::1 | POST     "/api/players/quickstart"
[0;37m13:35:56[0m [0;34m[API_SERVER][0m [GIN] 2025/08/15 - 13:35:56 | 200 |       20.75Âµs |             ::1 | POST     "/api/go-workers/webhook/events"
[0;37m13:36:12[0m [0;34m[API_SERVER][0m [GIN] 2025/08/15 - 13:36:12 | 200 |     354.167Âµs |             ::1 | POST     "/api/workers/control"
[0;37m13:36:12[0m [0;34m[API_SERVER][0m [GIN] 2025/08/15 - 13:36:12 | 200 |      19.083Âµs |             ::1 | POST     "/api/go-workers/webhook/events"
[0;37m13:36:15[0m [0;34m[API_SERVER][0m [GIN] 2025/08/15 - 13:36:15 | 200 |       898.5Âµs |             ::1 | POST     "/api/master/one"
[0;37m13:36:33[0m [0;34m[API_SERVER][0m [GIN] 2025/08/15 - 13:36:33 | 200 |     201.459Âµs |             ::1 | POST     "/api/workers/control"
[0;37m13:36:33[0m [0;32m[WORKERS][0m 2025/08/15 13:36:33 âœ… [Go Worker Debug] alice parsed message: {CaseID:single-gather-1755257775002343000 EventStage: Status: Source:frontend_send_one QuestType:gather Difficulty:1 WorkSec:2 Points:5 Weight:0 Player: Payload:map[]}
[0;37m13:36:33[0m [0;34m[API_SERVER][0m [GIN] 2025/08/15 - 13:36:33 | 200 |      21.083Âµs |             ::1 | POST     "/api/go-workers/webhook/events"
[0;37m13:36:33[0m [0;34m[API_SERVER][0m [GIN] 2025/08/15 - 13:36:33 | 200 |      37.667Âµs |             ::1 | POST     "/api/go-workers/webhook/events"
[0;37m13:36:35[0m [0;32m[WORKERS][0m 2025/08/15 13:36:35 âœ… [Go Worker Debug] alice parsed message: {CaseID:single-gather-1755257775002343000 EventStage:QUEST_COMPLETED Status:SUCCESS Source:go-worker:alice QuestType:gather Difficulty:1 WorkSec:0 Points:5 Weight:0 Player:alice Payload:map[]}
[0;37m13:36:35[0m [0;34m[API_SERVER][0m [GIN] 2025/08/15 - 13:36:35 | 200 |      48.625Âµs |             ::1 | POST     "/api/go-workers/webhook/events"
[0;37m13:36:35[0m [0;34m[API_SERVER][0m [GIN] 2025/08/15 - 13:36:35 | 200 |    3.250166ms |             ::1 | POST     "/api/dlq/reissue"
[0;37m13:36:35[0m [0;34m[API_SERVER][0m 2025/08/15 13:36:35 ğŸ“¬ [Go Worker Debug] alice received raw message: {"id":"q-1755257795-251814000","payload":{"id":"q-1755257387-678954000","payload":{"case_id":"startup-test","correlation_id":"6519da75-5cfe-4128-8725-eafc978ee1c6","points":5,"published_at":1755257387,"published_by":"api_endpoint","quest_type":"gather"},"points":5,"reissue_of":"","reissued_at":"2025-08-15T13:36:35+02:00","reissued_from_dlq":true,"timestamp":1755257387,"type":"game.quest.gather"},"points":5,"timestamp":1755257795,"type":"game.quest.gather"}
[0;37m13:36:35[0m [0;34m[API_SERVER][0m 2025/08/15 13:36:35 âœ… [Go Worker Debug] alice parsed message: {CaseID: EventStage: Status: Source: QuestType: Difficulty:0 WorkSec:0 Points:5 Weight:0 Player: Payload:map[case_id:startup-test correlation_id:6519da75-5cfe-4128-8725-eafc978ee1c6 points:5 published_at:1.755257387e+09 published_by:api_endpoint quest_type:gather]}
[0;37m13:37:31[0m [0;34m[API_SERVER][0m [GIN] 2025/08/15 - 13:37:31 | 200 |     863.375Âµs |             ::1 | POST     "/api/master/one"
[0;37m13:37:31[0m [0;32m[WORKERS][0m 2025/08/15 13:37:31 âœ… [Go Worker Debug] alice parsed message: {CaseID:single-gather-1755257851026465000 EventStage: Status: Source:frontend_send_one QuestType:gather Difficulty:1 WorkSec:2 Points:5 Weight:0 Player: Payload:map[]}
[0;37m13:37:31[0m [0;34m[API_SERVER][0m [GIN] 2025/08/15 - 13:37:31 | 200 |       49.25Âµs |             ::1 | POST     "/api/go-workers/webhook/events"
[0;37m13:37:33[0m [0;34m[API_SERVER][0m [GIN] 2025/08/15 - 13:37:33 | 200 |      83.292Âµs |             ::1 | POST     "/api/go-workers/webhook/events"
[0;37m13:37:33[0m [0;32m[WORKERS][0m 2025/08/15 13:37:33 âœ… [Go Worker Debug] alice parsed message: {CaseID:single-gather-1755257851026465000 EventStage:QUEST_COMPLETED Status:SUCCESS Source:go-worker:alice QuestType:gather Difficulty:1 WorkSec:0 Points:5 Weight:0 Player:alice Payload:map[]}
[0;37m13:37:34[0m [0;32m[WORKERS][0m 2025/08/15 13:37:34 ğŸ›‘ [Go Worker] Stopping alice...
[0;37m13:37:34[0m [0;35m[SYSTEM][0m 2025/08/15 13:37:34 ğŸ›‘ [Go Consumer] Context cancelled, stopping consumer for queue: game.skill.slay.q
[0;37m13:37:34[0m [0;35m[SYSTEM][0m 2025/08/15 13:37:34 ğŸ›‘ [Go Consumer] Context cancelled, stopping consumer for queue: game.skill.gather.q
[0;37m13:37:34[0m [0;32m[WORKERS][0m 2025/08/15 13:37:34 âœ… [Go Worker] alice stopped
[0;37m13:37:34[0m [0;32m[WORKERS][0m 2025/08/15 13:37:34 ğŸ›‘ [Server] Stopped worker: alice
[0;37m13:37:34[0m [0;34m[API_SERVER][0m [GIN] 2025/08/15 - 13:37:34 | 200 |      22.625Âµs |             ::1 | POST     "/api/go-workers/webhook/events"
[0;37m13:37:34[0m [0;34m[API_SERVER][0m [GIN] 2025/08/15 - 13:37:34 | 200 |    2.938667ms |             ::1 | POST     "/api/player/delete"
[0;37m13:37:39[0m [0;34m[API_SERVER][0m [GIN] 2025/08/15 - 13:37:39 | 200 |     956.167Âµs |             ::1 | POST     "/api/master/one"
[0;37m13:37:43[0m [0;32m[WORKERS][0m 2025/08/15 13:37:43 ğŸƒ [Go Worker] alice-worker-0 started on queue game.skill.gather.q
[0;37m13:37:43[0m [0;32m[WORKERS][0m 2025/08/15 13:37:43 âœ… [Go Worker Debug] alice parsed message: {CaseID:single-gather-1755257859023905000 EventStage: Status: Source:frontend_send_one QuestType:gather Difficulty:1 WorkSec:2 Points:5 Weight:0 Player: Payload:map[]}
[0;37m13:37:43[0m [0;34m[API_SERVER][0m [GIN] 2025/08/15 - 13:37:43 | 200 |      58.958Âµs |             ::1 | POST     "/api/go-workers/webhook/events"
[0;37m13:37:43[0m [0;32m[WORKERS][0m 2025/08/15 13:37:43 ğŸš€ [Go Worker] alice started with 1 workers, skills: [gather slay]
[0;37m13:37:43[0m [0;32m[WORKERS][0m 2025/08/15 13:37:43 âœ… [Server] Started worker: alice
[0;37m13:37:43[0m [0;32m[WORKERS][0m 2025/08/15 13:37:43 ğŸƒ [Go Worker] alice-worker-0 started on queue game.skill.slay.q
[0;37m13:37:43[0m [0;34m[API_SERVER][0m [GIN] 2025/08/15 - 13:37:43 | 200 |    7.340959ms |             ::1 | POST     "/api/players/quickstart"
[0;37m13:37:43[0m [0;34m[API_SERVER][0m [GIN] 2025/08/15 - 13:37:43 | 200 |      12.416Âµs |             ::1 | POST     "/api/go-workers/webhook/events"
[0;37m13:37:45[0m [0;34m[API_SERVER][0m [GIN] 2025/08/15 - 13:37:45 | 200 |      84.042Âµs |             ::1 | POST     "/api/go-workers/webhook/events"
[0;37m13:37:45[0m [0;32m[WORKERS][0m 2025/08/15 13:37:45 âœ… [Go Worker Debug] alice parsed message: {CaseID:single-gather-1755257859023905000 EventStage:QUEST_COMPLETED Status:SUCCESS Source:go-worker:alice QuestType:gather Difficulty:1 WorkSec:0 Points:5 Weight:0 Player:alice Payload:map[]}
[0;37m13:37:53[0m [0;34m[API_SERVER][0m [GIN] 2025/08/15 - 13:37:53 | 200 |      20.875Âµs |             ::1 | POST     "/api/dlq/reissue"
[0;37m13:38:10[0m [0;34m[API_SERVER][0m 2025/08/15 13:38:10 ğŸ›‘ [API Server] Shutting down...
[0;37m13:38:10[0m [0;34m[API_SERVER][0m 2025/08/15 13:38:10 âœ… [API Server] Graceful shutdown completed
[0;37m13:38:12[0m [0;35m[SYSTEM][0m 2025/08/15 13:38:12 ğŸ›‘ [Go Server] Shutting down...
[0;37m13:38:12[0m [0;32m[WORKERS][0m 2025/08/15 13:38:12 ğŸ›‘ [Go Server] Stopping worker: alice
[0;37m13:38:12[0m [0;32m[WORKERS][0m 2025/08/15 13:38:12 ğŸ›‘ [Go Worker] Stopping alice...
[0;37m13:38:12[0m [0;35m[SYSTEM][0m 2025/08/15 13:38:12 ğŸ›‘ [Go Consumer] Context cancelled, stopping consumer for queue: game.skill.slay.q
[0;37m13:38:12[0m [0;35m[SYSTEM][0m 2025/08/15 13:38:12 ğŸ›‘ [Go Consumer] Context cancelled, stopping consumer for queue: game.skill.gather.q
[0;37m13:38:12[0m [0;32m[WORKERS][0m 2025/08/15 13:38:12 âœ… [Go Worker] alice stopped
[0;37m13:38:12[0m [0;32m[WORKERS][0m 2025/08/15 13:38:12 ğŸ›‘ [Go Server] Stopping worker: bob
[0;37m13:38:12[0m [0;32m[WORKERS][0m 2025/08/15 13:38:12 ğŸ›‘ [Go Worker] Stopping bob...
[0;37m13:38:12[0m [0;35m[SYSTEM][0m 2025/08/15 13:38:12 ğŸ›‘ [Go Consumer] Context cancelled, stopping consumer for queue: game.skill.slay.q
[0;37m13:38:12[0m [0;35m[SYSTEM][0m 2025/08/15 13:38:12 ğŸ›‘ [Go Consumer] Context cancelled, stopping consumer for queue: game.skill.escort.q
[0;37m13:38:12[0m [0;32m[WORKERS][0m 2025/08/15 13:38:12 âŒ [Go Worker] Webhook failed: Post "http://localhost:9000/api/go-workers/webhook/events": dial tcp [::1]:9000: connect: connection refused
[0;37m13:38:12[0m [0;32m[WORKERS][0m 2025/08/15 13:38:12 âœ… [Go Worker] bob stopped
[0;37m13:38:12[0m [0;35m[SYSTEM][0m 2025/08/15 13:38:12 âœ… [Go Server] Shutdown complete

[1;33mğŸ›‘ Shutting down services...[0m
[0;34mStopping Go Workers (PID: 77868)...[0m
[0;34mStopping Go API Server (PID: 77825)...[0m
[0;32mâœ… All services stopped[0m
